<?php
session_start();
include 'koneksi.php';

// Fungsi untuk memeriksa apakah token CSRF valid
function isCsrfTokenValid()
{
    return isset($_POST['csrf_token']) && $_POST['csrf_token'] === $_SESSION['csrf_token'];
}

// Periksa apakah pengguna sudah login dan memiliki rolenya
if (!isset($_SESSION['username']) || !isset($_SESSION['role']) || $_SESSION['role'] !== 'pembimbing') {
    header('Location: ../login.php'); // Redirect ke halaman login jika belum login atau bukan pembimbing
    exit();
}

// Periksa apakah ID absensi siswa dikirimkan melalui POST
if (isset($_POST['hapus_data'])) {
    // Periksa kevalidan token CSRF
    if (!isCsrfTokenValid()) {
        exit("Error: Invalid CSRF token");
    }

    $idAbsensiSiswa = $_POST['id_absensi_siswa'];

    // Lakukan penghapusan data absensi siswa
    $queryHapusAbsensi = mysqli_query($conn, "DELETE FROM tb_absensi_siswa WHERE id_absensi_siswa = '$idAbsensiSiswa'");

    // Cek kesalahan pada query
    if (!$queryHapusAbsensi) {
        exit("Error: " . mysqli_error($conn));
    }

    echo "Data berhasil dihapus";
} else {
    echo "ID absensi siswa tidak ditemukan";
}
